from django.shortcuts import render
from django.shortcuts import render
from .forms import WebsiteLinkForm
from django.contrib.auth.mixins import LoginRequiredMixin
from django.contrib.auth.decorators import login_required
from django.views.generic import (TemplateView, ListView, CreateView, UpdateView, DeleteView, DetailView)
from django.utils import timezone
from django.urls import reverse_lazy
from .scripts.main_script import website_scanner

#pdf generation
from django.http import FileResponse
from reportlab.pdfgen import canvas
from django.template.loader import get_template
from io import BytesIO
from django.http import HttpResponse

@login_required
def website_link_view(request):
    initial_data = {
        'type_of_scan':1
    }
    output_rce = ''
    output_xss = ''
    output_sqli = ''
    unckecked_urls = ''
    scanned_ports = ''
    pdf = ''
    form = WebsiteLinkForm(initial=initial_data)

    if request.method == 'POST':
        form = WebsiteLinkForm(request.POST)
        if form.is_valid():
            website_link = form.cleaned_data['website_link']
            # sql_inject = form.cleaned_data['sql_injection']
            # rce = form.cleaned_data['rce']
            # xss = form.cleaned_data['xss']
            # output_xss, output_rce, output_sqli, unckecked_urls = website_scanner(website_link)
            print()
            website_scanner(website_link)
    return render(request, 'scanner/scanner_page.html', {'form': form})
